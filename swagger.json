{
  "swagger": "2.0",
  "info": {
    "title": "Kursutveckling API",
    "description": "Used to collect and show course analysis with some course data",
    "version": "1.0.0"
  },
  "basePath": "/api/kursutveckling",
  "produces": [
    "application/json"
  ],
  "securityDefinitions": {
    "api_key": {
      "type": "apiKey",
      "in": "header",
      "name": "api_key"
    }
  },
  "paths": {
    "/_checkAPIkey": {
      "get": {
        "operationId": "checkAPIkey",
        "summary": "GET a test endpoint that is protected by api key to validate that consumer has a proper api key",
        "description": "",
        "parameters": [],
        "tags": [
          "system"
        ],
        "responses": {
          "200": {
            "description": "An empty response",
            "schema": {
              "$ref": "#/definitions/UserList"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    },
    "/v1/courseRoundAnalysis/{id}": {
      "get": {
        "operationId": "getCourseRoundAnalysisDataById",
        "summary": "Get a list of all analysis connected to a course code",
        "description": "Get a list of all analysis connected to a course code",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Id of the round.semester.year.x to get analysis data",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "List of analyses for course code and all the data",
            "schema": {
              "$ref": "#/definitions/roundAnalysis"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      },
      "post": {
        "operationId": "postCourseRoundAnalysisDataById",
        "summary": "Saves an analysis object in the database",
        "description": "Saves an analysis object in the database",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Id of the round.semester.year.x to get analysis data",
            "required": true,
            "type": "string"
          },
          {
            "name": "roundAnalysisData",
            "in": "body",
            "description": "Analysis data  ",
            "schema": {
              "$ref": "#/definitions/roundAnalysis"
            }
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "A successful save"
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      },
      "put": {
        "operationId": "putCourseRoundAnalysisDataById",
        "summary": "Updates an analysis",
        "description": "Saves changes to an analysis in the database",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Id of the round.semester.year.x to get analysis data",
            "required": true,
            "type": "string"
          },
          {
            "name": "roundAnalysisData",
            "in": "body",
            "description": "Analysis data for a course round(s) round ",
            "schema": {
              "$ref": "#/definitions/roundAnalysis"
            }
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "A successful update"
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      },
      "delete": {
        "operationId": "deleteCourseRoundAnalysisDataById",
        "summary": "Delete an analysis",
        "description": "Delete all information for analysis with sent id",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Id of the round.semester.year.x to delete analysis data",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "The analysis was deleted",
            "schema": {
              "$ref": "#/definitions/roundAnalysis"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    },
    "/v1/usedRoundsForCourse/{courseCode}/semester/{semester}": {
      "get": {
        "operationId": "getUsedRounds",
        "summary": "Gets a list of used round ids for a semester in a course",
        "parameters": [
          {
            "name": "courseCode",
            "in": "path",
            "description": "Course code, six or seven characters",
            "required": true,
            "type": "string"
          },
          {
            "name": "semester",
            "description": "Semester for rounds",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "Round ids",
            "schema": {
              "$ref": "#/definitions/usedRoundsForCourseAndSemester"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    },
    "/v1/courseAnalysisList/{courseCode}": {
      "get": {
        "operationId": "getAnalysisListByCourseCode",
        "summary": "Get a list of analyses for a course",
        "description": "Gets analyses for rounds in a course",
        "parameters": [
          {
            "name": "courseCode",
            "in": "path",
            "description": "Id of the course code",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "Successfully got analyses for requested course code and semester",
            "schema": {
              "$ref": "#/definitions/roundAnalysis"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    },
    "/v1/courseAnalysisList/{courseCode}/{semester}": {
      "get": {
        "operationId": "getAnalysisListByCourseCodeSemester",
        "summary": "Get a list of analyses for a course",
        "description": "Gets analyses for rounds in a course",
        "parameters": [
          {
            "name": "courseCode",
            "in": "path",
            "description": "Id of the course code",
            "required": true,
            "type": "string"
          },
          {
            "name": "semester",
            "in": "path",
            "description": "Semester code, five numbers as a string (year + 1 (spring) or 2 (fall). Filter results for that semester",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "Successfully got analyses for requested course code and semester",
            "schema": {
              "$ref": "#/definitions/roundAnalysis"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    },
    "/v1/courseAnalyses/{semester}": {
      "get": {
        "operationId": "getCourseAnalysesForSemester",
        "summary": "Get a list of published analyses for a semester",
        "description": "Gets all published analyses for rounds in a semester",
        "parameters": [
          {
            "name": "semester",
            "in": "path",
            "description": "Semester code, five numbers as a string (year + 1 (spring) or 2 (fall). Filter results for that semester",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "Successfully got published analyses for requested semester",
            "schema": {
              "$ref": "#/definitions/roundAnalysis"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    },
    "/v1/archiveFragment": {
      "post": {
        "operationId": "postArchiveFragment",
        "summary": "Saves an archive fragment in the database",
        "description": "Saves an archive fragment in the database",
        "parameters": [
          {
            "name": "archiveFragment",
            "in": "body",
            "description": "Archive fragment",
            "schema": {
              "$ref": "#/definitions/ArchiveFragment"
            }
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "A successful save"
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      },
      "put": {
        "operationId": "putArchiveFragment",
        "summary": "Saves an archive fragment in the database",
        "description": "Saves an archive fragment in the database. Currently identical to post.",
        "parameters": [
          {
            "name": "archiveFragment",
            "in": "body",
            "description": "Archive fragment",
            "schema": {
              "$ref": "#/definitions/ArchiveFragment"
            }
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "A successful save"
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      },
      "get": {
        "operationId": "getAllArchiveFragments",
        "summary": "Gets a list of all archived fragments",
        "description": "Gets a list of all archived fragments.",
        "parameters": [],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "Successfully got all archived fragments",
            "schema": {
              "$ref": "#/definitions/ArchiveFragmentList"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    },
    "/v1/exportedArchiveFragment": {
      "put": {
        "operationId": "putExportedArchiveFragments",
        "summary": "Updates archive fragments in the database to exported",
        "description": "Updates archive fragments in the database to exported.",
        "parameters": [
          {
            "name": "ids",
            "in": "body",
            "description": "Archive fragment document ids",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "example": []
            }
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "A successful save"
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    },
    "/v1/createArchivePackage": {
      "post": {
        "operationId": "createArchivePackage",
        "summary": "Create an archive package",
        "description": "Creates an archive package out of archive fragments. Selection of fragments is based on supplied id:s. Used archive fragments will be marked as exported.",
        "produces": [
          "application/zip"
        ],
        "parameters": [
          {
            "name": "archiveFragmentIds",
            "in": "body",
            "description": "Selected archive fragment id:s to be included in package.",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "example": []
            }
          }
        ],
        "tags": [
          "v1"
        ],
        "responses": {
          "200": {
            "description": "Successfully created an archive package",
            "schema": {
              "type": "file"
            }
          },
          "default": {
            "description": "Unexpected error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        },
        "security": [
          {
            "api_key": []
          }
        ]
      }
    }
  },
  "definitions": {
    "roundAnalysis": {
      "type": "object",
      "required": [
        "courseCode"
      ],
      "properties": {
        "analysisName": {
          "type": "string",
          "description": "Analysis name"
        },
        "courseCode": {
          "type": "string",
          "description": "Course code for the course that are connected to the analysis"
        },
        "programmeCodes": {
          "type": "string",
          "description": "Programmes that are mandatory"
        },
        "examiners": {
          "type": "string",
          "description": "Examiner(s) for the course that semester"
        },
        "responsibles": {
          "type": "string",
          "description": "Responsible(s) for the course that semester"
        },
        "examinationRounds": {
          "type": "string",
          "description": "Examinations rounds for the course and semester"
        },
        "registeredStudents": {
          "type": "string",
          "description": "Number of registere student for round(s) that semester"
        },
        "examinationGrade": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Precentage of students completed the round(s)"
        },
        "endDate": {
          "type": "string",
          "description": "End date for round(s) that semester"
        },
        "alterationText": {
          "type": "string",
          "description": "Text that descibes changes that have been made in the course"
        },
        "commentExam": {
          "type": "string",
          "description": "Comment to Examination round(s)"
        },
        "commentChange": {
          "type": "string",
          "description": "Mandatory text if changes are made after analysis been published"
        },
        "isPublished": {
          "type": "string",
          "description": "Sets to true when analysis is published"
        },
        "publishedDate": {
          "type": "string",
          "description": "Date when analysis is first published"
        },
        "pdfAnalysisDate": {
          "type": "string",
          "description": "Date when analysis file was uploaded"
        },
        "pdfPMDate": {
          "type": "string",
          "description": "Date when pm/memo file was uploaded"
        },
        "changedDate": {
          "type": "string",
          "description": "Date when an analysis was updated"
        },
        "changedBy": {
          "type": "string",
          "description": "Username of creator of the analysis"
        },
        "semester": {
          "type": "string",
          "description": "Course semester for analysis"
        },
        "roundIdList": {
          "type": "string",
          "description": "Round id(s) used in analysis"
        },
        "analysisFileName": {
          "type": "string",
          "description": "Name of uploaded analysis file"
        },
        "pmFileName": {
          "type": "string",
          "description": "Name of uploaded pm/memo file"
        },
        "ugKeys": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "UG Keys for user access to edit analysis"
        },
        "syllabusStartTerm": {
          "type": "string",
          "description": "Connected syllabus"
        },
        "changedAfterPublishedDate": {
          "type": "string",
          "description": "Date for changes made after published"
        },
        "examinationGradeFromLadok": {
          "type": "boolean",
          "description": "A check if values been collected from Ladok or filled in by user"
        },
        "registeredStudentsFromLadok": {
          "type": "boolean",
          "description": "A check if values been collected from Ladok or filled in by user"
        },
        "registeredStudentsLadok": {
          "type": "integer",
          "description": "The result of registered students that was collected from Ladok "
        },
        "examinationGradeLadok": {
          "type": "integer",
          "description": "The result of examination grade that was collected from Ladok "
        },
        "endDateFromLadok": {
          "type": "boolean",
          "description": "A check if values been collected from Ladok or filled in by user"
        },
        "endDateLadok": {
          "type": "string",
          "description": "The end date used for result of examination grade that was collected from Ladok "
        },
        "ladokUIDs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "The UIDs collected from Ladok"
        }
      }
    },
    "usedRoundsForCourseAndSemester": {
      "properties": {
        "usedRounds": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of round ids that have been used for a course semester"
        },
        "publishedAnalysis": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/UsedAnalysis"
          },
          "description": "List of published analysis, name, id, UGkeys"
        },
        "draftAnalysis": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/UsedAnalysis"
          },
          "description": "List of draft analysis, name, id, UGkeys"
        }
      }
    },
    "UsedAnalysis": {
      "properties": {
        "user": {
          "type": "string"
        },
        "isPublished": {
          "type": "boolean"
        },
        "analysisId": {
          "type": "string"
        },
        "analysisName": {
          "type": "string"
        },
        "ugKeys": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "Error": {
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "fields": {
          "type": "string"
        }
      }
    },
    "UserList": {
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "fields": {
          "type": "string"
        }
      }
    },
    "ArchiveFragment": {
      "type": "object",
      "required": [
        "courseCode",
        "courseName",
        "courseRound",
        "semester",
        "analysisName",
        "responsibles",
        "examiners",
        "publishedDate"
      ],
      "properties": {
        "courseCode": {
          "type": "string",
          "description": "Element Kurskod. Mappar mot KIP-databas-element 'courseCode'.",
          "example": "AE2503"
        },
        "courseName": {
          "type": "string",
          "description": "Element Kursnamn. Kursbenämning.",
          "example": "Miljödata"
        },
        "courseRound": {
          "type": "string",
          "description": "Element Kurstillfalleskod. Mappar mot KIP-databas-element '_id'.",
          "example": "AE2503HT2017_1"
        },
        "semester": {
          "type": "string",
          "description": "Element Termin. Mappar mot KIP-databas-element 'semester'.",
          "example": "HT2017"
        },
        "analysisName": {
          "type": "string",
          "description": "Element Kursomgangomfang. Mappar mot KIP-databas-element 'analysisName'.",
          "example": "TIELA ( Startdatum 2016-08-29, Svenska ) , TIDAA ( Startdatum 2016-08-29, Svenska )"
        },
        "responsibles": {
          "type": "string",
          "description": "Element Kursansvarig. Mappar mot KIP-databas-element 'responsibles'.",
          "example": "Katrin Grünfeld"
        },
        "examiners": {
          "type": "string",
          "description": "Element Examinator. Mappar mot KIP-databas-element 'examiners'.",
          "example": "Ulla Mörtberg"
        },
        "description": {
          "type": "string",
          "description": "Element Beskrivning. Hårdkodat värde 'Kursanalys'.",
          "default": "Kursanalys",
          "example": "Kursanalys"
        },
        "publishedDate": {
          "type": "string",
          "description": "Element Publiceringsdatum. Som KIP-databas-element publishedDate, men DateTime-format.",
          "example": "2019-09-11T14:01:50+00:00"
        },
        "preserve": {
          "type": "integer",
          "description": "Element Bevaras. Hårdkodat värde 1.",
          "default": 1,
          "example": 1
        },
        "attachments": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ArchiveAttachment"
          },
          "description": "Element Bilaga. Lista av bilagda filer.",
          "example": []
        }
      }
    },
    "ArchiveAttachment": {
      "type": "object",
      "required": [
        "fileName",
        "remarks",
        "fileDate",
        "publishedDate"
      ],
      "properties": {
        "fileName": {
          "type": "string",
          "description": "Element Filnamn. Mappar mot KIP-databas-element 'analysisFileName'.",
          "example": "analysis-AE2503HT2017_1.pdf"
        },
        "remarks": {
          "type": "string",
          "description": "Element Anmarkning. Mappar mot KIP-databas-element 'alterationText'.",
          "example": "Förändringar från föregående kursomgång: Ny examinationsform inför 2018."
        },
        "fileDate": {
          "type": "string",
          "description": "Element Expedieringsdatum. Mappar mot KIP-databas-element 'pdfAnalysisDate'.",
          "example": "2019-08-19"
        },
        "publishedDate": {
          "type": "string",
          "description": "Element TidVersion. En tidpunkt (dateTime) för när versionen publicerades. Mappar mot KIP-databas-element 'changedAfterPublishedDate', fast på filnivå.",
          "example": "2019-09-11T14:01:50+00:00"
        }
      }
    },
    "ArchiveFragmentList": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ArchiveFragment"
      },
      "description": "List of archive fragments",
      "example": []
    }
  }
}